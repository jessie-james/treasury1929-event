<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Table Position Editor</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .editor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    button {
      padding: 8px 16px;
      background-color: #3b82f6;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
    }
    
    button:hover {
      background-color: #2563eb;
    }
    
    .save-button {
      background-color: #10b981;
    }
    
    .save-button:hover {
      background-color: #059669;
    }
    
    .editor-container {
      position: relative;
      border: 1px solid #ccc;
      background-color: white;
      overflow: hidden;
      margin-bottom: 20px;
      width: 100%;
      height: 700px;
    }
    
    .background-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    
    .table-circle {
      position: absolute;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      font-size: 9px;
      color: #333;
      cursor: move;
      z-index: 10;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.15);
    }
    
    .table-circle.available {
      background-color: rgba(74, 222, 128, 0.4);
      border: 1px solid rgba(22, 163, 74, 0.7);
    }
    
    .table-circle.unavailable {
      background-color: rgba(156, 163, 175, 0.5);
      border: 1px solid rgba(107, 114, 128, 0.7);
    }

    .table-circle.selected {
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
    }
    
    .code-output {
      background-color: #1e293b;
      color: #e2e8f0;
      padding: 15px;
      border-radius: 6px;
      font-family: monospace;
      white-space: pre;
      overflow-x: auto;
      margin-top: 20px;
    }
    
    .size-controls {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .size-controls label {
      margin-right: 5px;
    }
    
    .size-controls input {
      width: 60px;
      padding: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    
    .position-indicator {
      position: fixed;
      bottom: 10px;
      left: 10px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 12px;
      font-family: monospace;
      z-index: 1000;
    }
    
    .instructions {
      background-color: #f0f9ff;
      border: 1px solid #bae6fd;
      border-radius: 6px;
      padding: 10px 15px;
      margin-bottom: 20px;
    }
    
    .instructions ul {
      margin: 5px 0;
      padding-left: 20px;
    }
    
    .instructions li {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="editor-header">
      <h1>Table Position Editor</h1>
      <button id="saveBtn" class="save-button">Copy Table Positions</button>
    </div>
    
    <div class="instructions">
      <p><strong>Instructions:</strong></p>
      <ul>
        <li><strong>Drag</strong> - Click and drag tables to position them</li>
        <li><strong>Number Keys (1-7)</strong> - Select a table by its number</li>
        <li><strong>Arrow Keys</strong> - Fine-tune selected table position (1px movement)</li>
        <li><strong>Shift + Arrow Keys</strong> - Move selected table by 5px</li>
        <li><strong>Ctrl + Arrow Keys</strong> - Move selected table by 10px</li>
        <li>When done, click <strong>Copy Table Positions</strong> and paste the code into mezzanine-optimized.html</li>
      </ul>
    </div>
    
    <div class="size-controls">
      <label for="tableSize">Table Size:</label>
      <input type="number" id="tableSize" value="17" min="5" max="50">
      <button id="applySizeBtn">Apply Size</button>
    </div>
    
    <div class="controls">
      <button id="resetViewBtn">Reset View</button>
      <button id="createJsCodeBtn">Generate JS Code</button>
    </div>
    
    <div class="editor-container" id="editorContainer">
      <img src="/mezzanine-floor-plan.png" alt="Floor Plan" class="background-image" id="floorPlanImage">
    </div>
    
    <div class="code-output" id="codeOutput"></div>
    <div class="position-indicator" id="positionIndicator"></div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const editorContainer = document.getElementById('editorContainer');
      const codeOutput = document.getElementById('codeOutput');
      const positionIndicator = document.getElementById('positionIndicator');
      const saveBtn = document.getElementById('saveBtn');
      const resetViewBtn = document.getElementById('resetViewBtn');
      const createJsCodeBtn = document.getElementById('createJsCodeBtn');
      const tableSizeInput = document.getElementById('tableSize');
      const applySizeBtn = document.getElementById('applySizeBtn');
      
      let selectedTable = null;
      let tableSize = parseInt(tableSizeInput.value);
      let isDragging = false;
      let dragOffsetX = 0;
      let dragOffsetY = 0;
      
      // Initial table definitions
      const tableDefinitions = [
        { id: 1, left: 939, top: 305, width: 17, height: 17, status: 'available' },
        { id: 2, left: 838, top: 382, width: 17, height: 17, status: 'available' },
        { id: 3, left: 665, top: 372, width: 17, height: 17, status: 'available' },
        { id: 4, left: 518, top: 367, width: 17, height: 17, status: 'unavailable' },
        { id: 5, left: 349, top: 372, width: 17, height: 17, status: 'unavailable' },
        { id: 6, left: 171, top: 382, width: 17, height: 17, status: 'available' },
        { id: 7, left: 83, top: 300, width: 17, height: 17, status: 'available' }
      ];
      
      // Create tables
      function createTables() {
        // Clear existing tables
        document.querySelectorAll('.table-circle').forEach(table => table.remove());
        
        tableDefinitions.forEach(table => {
          const tableElement = document.createElement('div');
          tableElement.className = `table-circle ${table.status}`;
          tableElement.textContent = table.id;
          tableElement.dataset.id = table.id;
          tableElement.style.width = `${table.width}px`;
          tableElement.style.height = `${table.height}px`;
          tableElement.style.left = `${table.left}px`;
          tableElement.style.top = `${table.top}px`;
          
          tableElement.addEventListener('mousedown', startDragging);
          editorContainer.appendChild(tableElement);
        });
      }
      
      // Handle mouse down on a table
      function startDragging(e) {
        e.preventDefault();
        
        // Deselect previous table
        if (selectedTable) {
          selectedTable.classList.remove('selected');
        }
        
        selectedTable = this;
        selectedTable.classList.add('selected');
        
        // Calculate offset for dragging
        const rect = selectedTable.getBoundingClientRect();
        dragOffsetX = e.clientX - rect.left;
        dragOffsetY = e.clientY - rect.top;
        
        isDragging = true;
        
        // Update the position indicator
        updatePositionIndicator();
      }
      
      // Handle mouse move
      document.addEventListener('mousemove', function(e) {
        if (!isDragging || !selectedTable) return;
        
        const editorRect = editorContainer.getBoundingClientRect();
        const tableId = parseInt(selectedTable.dataset.id);
        const tableIndex = tableDefinitions.findIndex(t => t.id === tableId);
        
        if (tableIndex === -1) return;
        
        // Calculate new position
        let newLeft = e.clientX - editorRect.left - dragOffsetX;
        let newTop = e.clientY - editorRect.top - dragOffsetY;
        
        // Update table position in the DOM
        selectedTable.style.left = `${newLeft}px`;
        selectedTable.style.top = `${newTop}px`;
        
        // Update table position in the data
        tableDefinitions[tableIndex].left = Math.round(newLeft);
        tableDefinitions[tableIndex].top = Math.round(newTop);
        
        // Update position indicator
        updatePositionIndicator();
      });
      
      // Handle mouse up
      document.addEventListener('mouseup', function() {
        isDragging = false;
      });
      
      // Handle keyboard arrow keys for fine adjustment
      document.addEventListener('keydown', function(e) {
        // Number keys 1-9 to select tables
        if (e.key >= '1' && e.key <= '7') {
          const tableId = parseInt(e.key);
          const tableElement = document.querySelector(`.table-circle[data-id="${tableId}"]`);
          
          if (tableElement) {
            // Deselect previous table
            if (selectedTable) {
              selectedTable.classList.remove('selected');
            }
            
            // Select new table
            selectedTable = tableElement;
            selectedTable.classList.add('selected');
            
            // Update position indicator
            updatePositionIndicator();
            return;
          }
        }
        
        if (!selectedTable) return;
        
        const tableId = parseInt(selectedTable.dataset.id);
        const tableIndex = tableDefinitions.findIndex(t => t.id === tableId);
        if (tableIndex === -1) return;
        
        let offsetX = 0;
        let offsetY = 0;
        
        // Arrow keys - 1px movement
        // With shift - 5px movement
        // With ctrl - 10px movement
        const moveAmount = e.shiftKey ? 5 : (e.ctrlKey ? 10 : 1);
        
        switch (e.key) {
          case 'ArrowLeft':
            offsetX = -moveAmount;
            break;
          case 'ArrowRight':
            offsetX = moveAmount;
            break;
          case 'ArrowUp':
            offsetY = -moveAmount;
            break;
          case 'ArrowDown':
            offsetY = moveAmount;
            break;
          default:
            return; // Not an arrow key
        }
        
        // Prevent default scrolling
        e.preventDefault();
        
        // Update table position
        const newLeft = tableDefinitions[tableIndex].left + offsetX;
        const newTop = tableDefinitions[tableIndex].top + offsetY;
        
        // Update table position in the data
        tableDefinitions[tableIndex].left = newLeft;
        tableDefinitions[tableIndex].top = newTop;
        
        // Update table position in the DOM
        selectedTable.style.left = `${newLeft}px`;
        selectedTable.style.top = `${newTop}px`;
        
        // Update position indicator
        updatePositionIndicator();
        
        // Generate updated code
        generateJsCode();
      });
      
      // Update position indicator
      function updatePositionIndicator() {
        if (!selectedTable) {
          positionIndicator.textContent = '';
          return;
        }
        
        const tableId = parseInt(selectedTable.dataset.id);
        const table = tableDefinitions.find(t => t.id === tableId);
        
        if (table) {
          positionIndicator.textContent = `Table ${table.id}: left=${table.left}, top=${table.top}`;
        }
      }
      
      // Generate JS code for table definitions
      function generateJsCode() {
        const code = `      // Table definitions with precise positioning
      const tableDefinitions = [
        ${tableDefinitions.map(table => 
          `{ id: ${table.id}, left: ${table.left}, top: ${table.top}, width: ${table.width}, height: ${table.height}, status: '${table.status}' }`
        ).join(',\n        ')}
      ];`;
        
        codeOutput.textContent = code;
        return code;
      }
      
      // Apply size to all tables
      applySizeBtn.addEventListener('click', function() {
        const newSize = parseInt(tableSizeInput.value);
        if (isNaN(newSize) || newSize < 5 || newSize > 50) return;
        
        tableSize = newSize;
        
        // Update all table sizes
        tableDefinitions.forEach(table => {
          table.width = tableSize;
          table.height = tableSize;
        });
        
        // Recreate tables
        createTables();
        
        // Generate updated code
        generateJsCode();
      });
      
      // Save button - copy code to clipboard
      saveBtn.addEventListener('click', function() {
        const code = generateJsCode();
        navigator.clipboard.writeText(code)
          .then(() => {
            saveBtn.textContent = 'Copied!';
            setTimeout(() => {
              saveBtn.textContent = 'Copy Table Positions';
            }, 2000);
          })
          .catch(err => {
            console.error('Failed to copy: ', err);
          });
      });
      
      // Reset view button
      resetViewBtn.addEventListener('click', function() {
        if (selectedTable) {
          selectedTable.classList.remove('selected');
          selectedTable = null;
        }
        
        updatePositionIndicator();
      });
      
      // Create JS code button
      createJsCodeBtn.addEventListener('click', generateJsCode);
      
      // Initialize the editor
      createTables();
      generateJsCode();
    });
  </script>
</body>
</html>